var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();System.register("tinyts/core/http",[],function(exports_1,context_1){"use strict";var UrlComparison,UrlParser,HttpResponse,HttpUtils,Router,routerInstance;context_1&&context_1.id;return{setters:[],execute:function(){UrlComparison=function(){return function(){}}(),exports_1("UrlComparison",UrlComparison),UrlParser=function(){function UrlParser(){}return UrlParser.prototype.Parse=function(url){this.url=url,this.searchObject={};var queries,split,i,parser=document.createElement("a");for(parser.href=this.url,queries=parser.search.replace(/^\?/,"").split("&"),i=0;i<queries.length;i++)if(""!=(split=queries[i].split("="))[0]&&split[1]){var key=split[0],val=decodeURIComponent(split[1]);if(this.searchObject[key])if(Array.isArray(this.searchObject[key]))this.searchObject[key].push(val);else{var temp=this.searchObject[key];this.searchObject[key]=[],this.searchObject[key].push(temp),this.searchObject[key].push(val)}else this.searchObject[key]=val}return this.protocol=parser.protocol,this.host=parser.host,this.hostname=parser.hostname,this.port=parser.port,this.pathname=0==parser.pathname.indexOf("/")?parser.pathname:"/"+parser.pathname,this.search=parser.search,this.hash=parser.hash,this.segments=this.pathname.substr(1).split("/"),this},UrlParser.prototype.Generate=function(){this.search="?";for(var temp in this.searchObject)this.search+=temp+"="+this.searchObject[temp]+"&";return this.search=this.search.substr(0,this.search.length-1),this.url="",this.protocol&&(this.protocol.endsWith(":")||(this.protocol+=":"),this.url+=this.protocol+"//"),this.url+=this.host,isNaN(+this.port)||(this.url+=":"+this.port),this.url+=this.pathname+this.search+this.hash,this.url},UrlParser.CompareUrls=function(url1,url2){var temp=new UrlComparison,u1=new UrlParser,u2=new UrlParser;return u1.Parse(url1),u2.Parse(url2),temp.Path=u1.pathname.toLowerCase()==u2.pathname.toLocaleLowerCase(),temp.Search=u1.search.toLowerCase()==u2.search.toLowerCase(),temp.Hash=u1.hash.toLowerCase()==u2.hash.toLowerCase(),temp.Host=u1.host.toLowerCase()==u2.host.toLowerCase(),temp.Hash&&temp.Host&&temp.Path&&temp.Search?temp.Complete=!0:temp.Complete=!1,temp},UrlParser}(),exports_1("UrlParser",UrlParser),HttpResponse=function(){return function(){}}(),exports_1("HttpResponse",HttpResponse),HttpUtils=function(){function HttpUtils(){}return HttpUtils.Get=function(url,params,otherOptions){return new Promise(function(resolve,reject){var baseOptions={url:url,type:"GET",data:params,success:function(data,textStatus,jqXHR){var dd=new HttpResponse;dd.ResponseBody=data,dd.HttpStatus=jqXHR.status,dd.jqXHR=jqXHR,resolve(dd)},error:function(jqXHR,textStatus,errorThrown){reject(jqXHR.status)}};otherOptions&&(baseOptions=$.extend({},baseOptions,otherOptions)),$.ajax(baseOptions)})},HttpUtils.Post=function(url,params,otherOptions){return new Promise(function(resolve,reject){var baseOptions={url:url,type:"POST",data:params,success:function(data,textStatus,jqXHR){var dd=new HttpResponse;dd.ResponseBody=data,dd.HttpStatus=jqXHR.status,dd.jqXHR=jqXHR,resolve(dd)},error:function(jqXHR,textStatus,errorThrown){reject(jqXHR.status)}};otherOptions&&(baseOptions=$.extend({},baseOptions,otherOptions)),$.ajax(baseOptions)})},HttpUtils}(),exports_1("HttpUtils",HttpUtils),Router=function(){function Router(){var me=this;window.onpopstate=function(event){var state=event.state;me.context&&me.context.OnRoutePopState(state)}}return Router.prototype.SetContext=function(context){this.context=context},Router.prototype.GoBack=function(){window.history.back()},Router.prototype.GoForward=function(){window.history.forward()},Router.prototype.GoTo=function(url,data,param){if(!UrlParser.CompareUrls(window.location.href,url).Complete){var me=this,stateData={url:url,data:data,param:param};window.history.pushState&&window.history.pushState(stateData,"",url),me.context&&me.context.OnRouteChange(url,data)}},Router.prototype.ReplaceCurrentState=function(url,data,param){var me=this,stateData={url:url,data:data,param:param};window.history.replaceState&&window.history.replaceState(stateData,"",url),me.context&&me.context.OnRouteChange(url,data)},Router.prototype.ReplaceCurrentStateWithParam=function(url,data,changeRoute){var me=this,xx=new UrlParser;xx.Parse(url),xx.searchObject=$.extend(xx.searchObject,data);var url2=xx.Generate(),stateData={url:url,data:{}};window.history.replaceState&&window.history.replaceState(stateData,"",url2),changeRoute&&me.context&&me.context.OnRouteChange(url2,stateData)},Router}(),exports_1("routerInstance",routerInstance=new Router)}}}),System.register("tinyts/core/servicepool",[],function(exports_2,context_2){"use strict";var ServicePool,ServicePoolInstance;context_2&&context_2.id;return{setters:[],execute:function(){ServicePool=function(){function ServicePool(){this.instances={}}return ServicePool.prototype.GetService=function(Class){var name=Class.prototype.constructor.name;return name||(name=Class.toString().match(/^function\s*([^\s(]+)/)[1]),this.instances[name]||(this.instances[name]=new Class),this.instances[name]},ServicePool.prototype.ReleaseService=function(){},ServicePool}(),exports_2("ServicePoolInstance",ServicePoolInstance=new ServicePool)}}}),System.register("tinyts/core/view",["tinyts/core/http","tinyts/core/servicepool"],function(exports_3,context_3){"use strict";var http_1,servicepool_1,injectModel,serviceInjectModel,ViewState,BindType,DataBindExpressionModel,TreeNode,View,ViewG,ViewV;context_3&&context_3.id;return{setters:[function(http_1_1){http_1=http_1_1},function(servicepool_1_1){servicepool_1=servicepool_1_1}],execute:function(){injectModel=function(){return function(){}}(),exports_3("injectModel",injectModel),serviceInjectModel=function(){return function(){}}(),exports_3("serviceInjectModel",serviceInjectModel),function(ViewState){ViewState[ViewState.UNLOAD=0]="UNLOAD",ViewState[ViewState.LOADSUCC=1]="LOADSUCC",ViewState[ViewState.LOADFAIL=2]="LOADFAIL"}(ViewState||(ViewState={})),exports_3("ViewState",ViewState),function(BindType){BindType[BindType.OVONIC=0]="OVONIC",BindType[BindType.MODELTOVIEW=1]="MODELTOVIEW",BindType[BindType.VIEWTOMODEL=2]="VIEWTOMODEL"}(BindType||(BindType={})),DataBindExpressionModel=function(){return function(Expression,ViewInstance){this.Expression=Expression,this.ViewInstance=ViewInstance}}(),TreeNode=function(){function TreeNode(){this.Child=[],this.Views=[]}return TreeNode.prototype.AddChild=function(c){1==mx(this.Child).where(function(it){return it.Expression==c.Expression}).count()?this.CombineChild(c):this.Child.push(c)},TreeNode.prototype.CombineChild=function(c){var child=mx(this.Child).where(function(it){return it.Expression==c.Expression}).first();if(c.Views.length>0)for(i=0;i<c.Views.length;i++)child.Views.push(c.Views[i]);else for(var i=0;i<c.Child.length;i++)child.AddChild(c.Child[i])},TreeNode.prototype.Resolve=function(data,view,type){if(data.length<1)return null;if(this.Expression=data[0],1==data.length&&this.Views.push({ViewInstance:view,Type:type}),data.length>1){var temp=(new TreeNode).Resolve(data.slice(1),view,type);temp&&this.Child.push(temp)}return this},TreeNode.prototype.BuildProxy=function(){var _this=this,temp={};if(this.Views.length>0){Object.defineProperty(temp,this.Expression,{enumerable:!0,set:function(value){_this.Views.forEach(function(v,i,a){v.Type!=BindType.OVONIC&&v.Type!=BindType.MODELTOVIEW||(temp["_"+_this.Expression]=value,v.ViewInstance.SetValue(value))})},get:function(){for(var i=0;i<_this.Views.length;i++)if(_this.Views[i].Type==BindType.OVONIC||_this.Views[i].Type==BindType.VIEWTOMODEL)return _this.Views[i].ViewInstance.Value();return temp["_"+_this.Expression]}});for(i=0;i<this.Views.length;i++){var temp_view=this.Views[i];if(temp_view.ViewInstance&&temp_view.Type==BindType.OVONIC||temp_view.Type==BindType.VIEWTOMODEL){var element=temp_view.ViewInstance.GetJQueryInstance()[0];if(element instanceof HTMLInputElement||element instanceof HTMLTextAreaElement){var lock=!1;temp_view.ViewInstance.On("compositionstart",function(){lock=!0,temp[_this.Expression]=_this.Views[i].ViewInstance.Value()}),temp_view.ViewInstance.On("compositionend",function(){lock=!1,temp[_this.Expression]=_this.Views[i].ViewInstance.Value()}),temp_view.ViewInstance.On("input",function(){lock||(temp[_this.Expression]=_this.Views[i].ViewInstance.Value())});break}}}}else{for(var child={},i=0;i<this.Child.length;i++)Object.defineProperty(child,this.Child[i].Expression,Object.getOwnPropertyDescriptor(this.Child[i].BuildProxy(),this.Child[i].Expression));temp["_"+this.Expression]={},Object.defineProperty(temp,this.Expression,{enumerable:!0,set:function(value){if(value instanceof Object)for(var p in value)Object.getOwnPropertyDescriptor(temp["_"+_this.Expression],p)?temp["_"+_this.Expression][p]=value[p]:Object.defineProperty(temp["_"+_this.Expression],p,Object.getOwnPropertyDescriptor(value,p))},get:function(){return temp["_"+_this.Expression]}}),temp[this.Expression]=child}return temp},TreeNode}(),View=function(){function View(){}return View.prototype.Value=function(){return this.name},View.prototype.SetValue=function(value){},View.prototype.SetName=function(name){this.name=name},View.prototype.Name=function(){return this.name},View.prototype.IsMultiparted=function(){return!!this.multipart&&this.multipart},View.prototype.PropertyName=function(){return this.propertyName},View.prototype.SetAttr=function(attrName,value){this.target.data(attrName,value)},View.prototype.Attr=function(attrName){return this.target.data(attrName)},View.prototype.SetSelector=function(selector){this.selector=selector},View.prototype.LoadView=function(parent){if(void 0!=this.state&&this.state!=ViewState.UNLOAD&&console.warn("it's deprecated to call loadview twice!"),!this.selector)return this.state=ViewState.LOADFAIL,console.warn("[view]"+this.name+" has not set selector!"),!1;this.target=parent?"string"==typeof parent?$(parent).find(this.selector):parent.find(this.selector):$(this.selector);var matchedElementLength=this.target.length;if(matchedElementLength>0){if(this.state=ViewState.LOADSUCC,this.propertyName=this.target.attr("data-property"),this.bindingExpression=this.target.attr("data-bind"),this.bindingExpression){var temp=this.bindingExpression.split(":");temp[1]?this.bindType="tov"==temp[1].toLowerCase()?BindType.MODELTOVIEW:"tom"==temp[1].toLowerCase()?BindType.VIEWTOMODEL:BindType.OVONIC:this.bindType=BindType.OVONIC,this.bindings=temp[0].split(".")}if(matchedElementLength>1){this.multipart=!0;for(var i=1;i<matchedElementLength;i++)if(this.propertyName!=this.target.eq(i).attr("data-property")){console.warn("[view]"+this.propertyName+" mismatched the "+i+" element. you cannot use injector with this view any more."),this.propertyName=null;break}}return!0}return this.state=ViewState.LOADFAIL,console.warn("[view]"+this.name+" bind null html element!"),!1},View.prototype.GetJQueryInstance=function(){return console.warn("[view]jquery instance is deprecated to use."),this.target},View.prototype.Focus=function(){this.target.focus()},View.prototype.On=function(eventName,handler){var _this=this;this.eventList||(this.eventList={});var needBind=!1;null==this.eventList[eventName]&&(needBind=!0,this.eventList[eventName]=[]),this.eventList[eventName].push(handler),needBind&&null!=this.target&&this.target.on(eventName,function(eventObj){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var i=0;i<_this.eventList[eventName].length;i++)(_a=_this.eventList[eventName])[i].apply(_a,[eventObj].concat(args));var _a})},View.prototype.Trigger=function(eventName,index){if(this.multipart){if(-1==index)return void this.target.trigger(eventName);null==index&&(index=0),this.target.eq(index).trigger(eventName)}else this.target.trigger(eventName)},View.prototype.Off=function(eventName){null!=this.target&&this.target.off(eventName),this.eventList&&(eventName?this.eventList[eventName]=[]:this.eventList={})},View.prototype.AddClass=function(className,selector){selector?this.target.find(selector).addClass(className):this.target.addClass(className)},View.prototype.RemoveClass=function(className,selector){selector?this.target.find(selector).removeClass(className):this.target.removeClass(className)},View.prototype.HasClass=function(className){return this.target.hasClass(className)},View.prototype.SetStyle=function(key,value){this.target.css(key,value)},View.prototype.Style=function(key,unit){return!1===unit?this.target.css(key).replace(/[^-\d\.]/g,""):this.target.css(key)},View.prototype.Disable=function(){this.target.attr("disabled","true")},View.prototype.Enable=function(){this.target.removeAttr("disabled")},View.prototype.DataBindExpression=function(){return this.bindingExpression},View.prototype.DataBind=function(){return this.bindings},View.prototype.Inject=function(){for(var c=this.constructor,injector={};c instanceof View.constructor;)injector=$.extend(injector,c.__inject__),c=c.__proto__;var instance=this,dataBindingExpressions=[];if(this.BeforeInject(),injector)for(var i in injector){var temp=injector[i];if(instance instanceof temp.constructor){var views=temp.views;if(views)for(j=0;j<views.length;j++){var view=views[j],viewInstance=new view.creator;viewInstance instanceof View&&(viewInstance.SetSelector(view.selector),viewInstance.SetName(view.propertyName),this.state!=ViewState.LOADSUCC||this.multipart?viewInstance.LoadView():viewInstance.LoadView(this.selector),viewInstance.DataBindExpression()&&dataBindingExpressions.push(new DataBindExpressionModel(viewInstance.DataBindExpression(),viewInstance)),viewInstance instanceof ViewG&&viewInstance.SetContext(this),viewInstance instanceof ViewV?function(){var temp=viewInstance;temp.SetTemplateView().then(function(){temp.Inject()})}():viewInstance.Inject()),instance[view.propertyName]=viewInstance}var services=temp.services;if(services)for(var j=0;j<services.length;j++){var service=services[j];instance[service.propertyName]=servicepool_1.ServicePoolInstance.GetService(service.creator)}}}this.ResolveDataBinding(dataBindingExpressions),this.AfterInject()},View.prototype.ResolveDataBinding=function(bindingExpressions){for(var root=new TreeNode,i=0;i<bindingExpressions.length;i++){var type,temp=bindingExpressions[i].Expression.split(":");type=temp[1]?"tov"==temp[1].toLowerCase()?BindType.MODELTOVIEW:"tom"==temp[1].toLowerCase()?BindType.VIEWTOMODEL:BindType.OVONIC:BindType.OVONIC;var segments=temp[0].split("."),node=new TreeNode;root.AddChild(node.Resolve(segments,bindingExpressions[i].ViewInstance,type))}for(i=0;i<root.Child.length;i++)Object.defineProperty(this,root.Child[i].Expression,Object.getOwnPropertyDescriptor(root.Child[i].BuildProxy(),root.Child[i].Expression))},View.prototype.BeforeInject=function(){},View.prototype.AfterInject=function(){},View}(),exports_3("View",View),ViewG=function(_super){function ViewG(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ViewG,_super),ViewG.prototype.SetContext=function(context){this.context=context},ViewG}(View),exports_3("ViewG",ViewG),ViewV=function(_super){function ViewV(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ViewV,_super),ViewV.prototype.GetViewString=function(){return""},ViewV.prototype.SetTemplateView=function(){var _this=this,url=this.constructor.__url__;return url?http_1.HttpUtils.Get(url).then(function(res){_this.target.html(res.ResponseBody)}):new Promise(function(resolve,reject){var s=_this.GetViewString();""==s&&(s=_this.viewString),_this.target.html(s),resolve()})},ViewV}(ViewG),exports_3("ViewV",ViewV)}}}),System.register("tinyts/control/text",["tinyts/core/view"],function(exports_4,context_4){"use strict";var view_1,TextView;context_4&&context_4.id;return{setters:[function(view_1_1){view_1=view_1_1}],execute:function(){TextView=function(_super){function TextView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TextView,_super),TextView.prototype.Value=function(){return this.target.text()},TextView.prototype.SetValue=function(v){this.target.text(v)},TextView.prototype.Clear=function(){this.target.text("")},TextView}(view_1.View),exports_4("TextView",TextView)}}}),System.register("tinyts/control/button",["tinyts/control/text"],function(exports_5,context_5){"use strict";var text_1,Button;context_5&&context_5.id;return{setters:[function(text_1_1){text_1=text_1_1}],execute:function(){Button=function(_super){function Button(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Button,_super),Button.prototype.OnClick=function(handler){this.target.click(handler)},Button.prototype.PerformClick=function(){null!=this.target&&this.target.click()},Button}(text_1.TextView),exports_5("Button",Button)}}}),System.register("tinyts/core/meta",[],function(exports_6,context_6){"use strict";var Meta;context_6&&context_6.id;return{setters:[],execute:function(){Meta=function(){function Meta(){}return Meta.Resolve=function(viewString,model){return Mustache.render(viewString,model)},Meta.Compile=function(viewString){Mustache.parse(viewString)},Meta}(),exports_6("Meta",Meta)}}}),System.register("tinyts/control/list",["tinyts/core/view","tinyts/core/meta"],function(exports_7,context_7){"use strict";var view_2,meta_1,ArrayProxy,ListView,PAGEMODE,PageManager;context_7&&context_7.id;return{setters:[function(view_2_1){view_2=view_2_1},function(meta_1_1){meta_1=meta_1_1}],execute:function(){ArrayProxy=function(_super){function ArrayProxy(data,context){var _this=_super.apply(this,data)||this;return Object.setPrototypeOf(_this,ArrayProxy.prototype),_this.context=context,_this}return __extends(ArrayProxy,_super),ArrayProxy.prototype.push=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var res=_super.prototype.push.apply(this,items);return this.context.RefreshView(),res},ArrayProxy.prototype.pop=function(){var res=_super.prototype.pop.call(this);return this.context.RefreshView(),res},ArrayProxy.prototype.shift=function(){var res=_super.prototype.shift.call(this);return this.context.RefreshView(),res},ArrayProxy.prototype.unshift=function(){for(var items=[],_i=0;_i<arguments.length;_i++)items[_i]=arguments[_i];var res=_super.prototype.unshift.apply(this,items);return this.context.RefreshView(),res},ArrayProxy.prototype.reverse=function(){var res=_super.prototype.reverse.call(this);return this.context.RefreshView(),res},ArrayProxy.prototype.sort=function(compareFn){var res=_super.prototype.sort.call(this,compareFn);return this.context.RefreshView(),res},ArrayProxy.prototype.splice=function(start,deleteCount){for(var items=[],_i=2;_i<arguments.length;_i++)items[_i-2]=arguments[_i];for(var temp=[],i=0;i<this.length;i++)temp[i]=this[i];var res=temp.splice.apply(temp,[start,deleteCount].concat(items));this.length=temp.length;for(i=0;i<temp.length;i++)this[i]=temp[i];return this.context.RefreshView(),res},ArrayProxy}(Array),exports_7("ArrayProxy",ArrayProxy),ListView=function(_super){function ListView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ListView,_super),ListView.prototype.LoadView=function(parent){var _this=this,succ=_super.prototype.LoadView.call(this,parent);if(this.viewString=[],succ){this.multipart?this.target.each(function(index,elem){_this.viewString[index]=_this.getTemplateString($(elem))}):this.viewString.push(this.getTemplateString(this.target)),this.ClearView();var pagable=this.target.attr("data-pagable");pagable&&(this.pageManager=new PageManager,this.pageManager.SetContext(this)),"sync"==pagable?this.pageManager.SetPageMode(PAGEMODE.SYNC):"async"==pagable&&this.pageManager.SetPageMode(PAGEMODE.ASYNC)}return succ},ListView.prototype.getTemplateString=function(target){return target.html()},ListView.prototype.SetEventHandler=function(selector,handler,event){this.eventHandler||(this.eventHandler=[]),this.eventHandler.push({selector:selector,handler:handler,event:event})},ListView.prototype.RemoveEventHandler=function(selector){for(var temp=[],i=0;i<this.eventHandler.length;i++)this.eventHandler[i].selector!=selector&&temp.push(this.eventHandler[i]);this.eventHandler=temp},ListView.prototype.UnbindEvents=function(selector,event){event?this.target.find(selector).off(event):this.target.find(selector).off()},ListView.prototype.SetData=function(data){data||(data=[]),this.state==view_2.ViewState.LOADSUCC?(this.mData=new ArrayProxy(data,this),this.RefreshView()):console.error(this.name+" load error!")},ListView.prototype.GetData=function(){if(!this.mData)return[];for(var temp=[],i=0;i<this.mData.length;i++)temp.push(this.mData[i]);return temp},ListView.prototype.SetValue=function(data){this.SetData(data)},ListView.prototype.Value=function(){return this.mData||(this.mData=new ArrayProxy([],this)),this.mData},ListView.prototype.RefreshView=function(){if(this.ClearView(),this.mData){for(var i=0;i<this.mData.length;i++)this.createView(i);this.RegisterEvents()}},ListView.prototype.GetView=function(dataIndex,elemIndex){var data=$.extend(!0,{},this.mData[dataIndex]);return this.getTemplpateModel&&(data=this.getTemplpateModel(data,dataIndex)),null==elemIndex&&(elemIndex=0),meta_1.Meta.Resolve(this.viewString[elemIndex],data)},ListView.prototype.createView=function(index){var _this=this;this.multipart?this.target.each(function(i,elem){_this.append(_this.GetView(index,i),i)}):this.append(this.GetView(index,0))},ListView.prototype.append=function(viewString,elemIndex){this.multipart?(null==elemIndex&&(elemIndex=0),this.target.eq(elemIndex).append(viewString)):this.target.append(viewString)},ListView.prototype.GetChildren=function(){return this.target.children()},ListView.prototype.Traverse=function(handler){this.GetChildren().each(function(index,elem){if(!handler(index,elem))return!1})},ListView.prototype.ClearView=function(){this.target.html("")},ListView.prototype.RegisterEvents=function(){this.eventHandler||(this.eventHandler=[]);for(i=0;i<this.eventHandler.length;i++)this.UnbindEvents(this.eventHandler[i].selector);for(var i=0;i<this.eventHandler.length;i++){var targetView=this.target.find(this.eventHandler[i].selector);this.eventHandler[i].event?targetView.on(this.eventHandler[i].event,this.eventHandler[i].handler):targetView.click(this.eventHandler[i].handler)}},ListView.prototype.GetPageManager=function(){return this.pageManager||console.error("data-pagable has not defined!"),this.pageManager},ListView.prototype.SetPageSize=function(pagesize){this.pageSize=pagesize},ListView.prototype.SetCurPage=function(page){},ListView.prototype.SetPageCount=function(count){},ListView.prototype.GetPageSize=function(){return this.pageSize},ListView}(view_2.View),exports_7("ListView",ListView),function(PAGEMODE){PAGEMODE[PAGEMODE.SYNC=0]="SYNC",PAGEMODE[PAGEMODE.ASYNC=1]="ASYNC"}(PAGEMODE||(PAGEMODE={})),PageManager=function(){function PageManager(instance){this.curPage=1}return PageManager.prototype.SetData=function(data){data&&(this.mData=data,this.SetRecordCount(this.mData.length))},PageManager.prototype.SetContext=function(context){this.context=context},PageManager.prototype.SetPageMode=function(mode){this.pageMode=mode},PageManager.prototype.ForceSetCurPage=function(index){this.curPage=index},PageManager.prototype.CurPage=function(){return this.curPage},PageManager.prototype.SetPageSize=function(pagesize){this.pageSize=pagesize},PageManager.prototype.RecordCount=function(){return this.total},PageManager.prototype.SetRecordCount=function(count){this.total=count,this.SetPageCount(Math.ceil(this.total/this.pageSize))},PageManager.prototype.SetPageCount=function(count){this.context.SetPageCount(count),this.pageCount=count},PageManager.prototype.ResetCurPage=function(){this.curPage=1},PageManager.prototype.GetCurPage=function(){this.context.SetCurPage(this.curPage);var pagesize=this.context.GetPageSize();if(pagesize){if(this.SetPageSize(pagesize),this.pageMode==PAGEMODE.SYNC)this.context.SetData(mx(this.mData).skip((this.curPage-1)*this.pageSize).take(this.pageSize).toArray());else if(this.pageMode==PAGEMODE.ASYNC){if(!this.context)throw"context has not been set!";this.getData(this.curPage,this.pageSize)}}else console.error("pagesize is wrong!")},PageManager.prototype.FirstPage=function(){this.curPage=1,this.GetCurPage()},PageManager.prototype.PrevPage=function(){this.curPage<=1||(this.curPage--,this.GetCurPage())},PageManager.prototype.NextPage=function(){this.context.GetPageSize()>=this.pageSize&&this.curPage>=this.pageCount||(this.curPage++,this.GetCurPage())},PageManager.prototype.LastPage=function(){this.pageCount<1||(this.curPage=this.pageCount,this.GetCurPage())},PageManager.prototype.TurnToPage=function(index){var nPageSize=this.context.GetPageSize();index<1||nPageSize>=this.pageSize&&index>this.pageCount||(this.curPage=index,this.GetCurPage())},PageManager}()}}}),System.register("tinyts/control/input",["tinyts/control/text"],function(exports_8,context_8){"use strict";var text_2,InputView;context_8&&context_8.id;return{setters:[function(text_2_1){text_2=text_2_1}],execute:function(){InputView=function(_super){function InputView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(InputView,_super),InputView.prototype.LoadView=function(parent){var _this=this,succ=_super.prototype.LoadView.call(this,parent);if(succ){var acceptSelector=this.target.attr("data-accept-button");acceptSelector&&(this.acceptBtn=$(acceptSelector)),this.On("keypress",function(args){13==args.which&&_this.acceptBtn&&(_this.acceptBtn.prop("disabled")||_this.acceptBtn.click())})}return succ},InputView.prototype.SetAcceptButton=function(p){"string"==typeof p?this.acceptBtn=$(p):"object"==typeof p&&(this.acceptBtn=p.GetJQueryInstance())},InputView.prototype.Value=function(){return this.target.val()},InputView.prototype.SetValue=function(v){this.target.val(v)},InputView.prototype.Clear=function(){this.target.val("")},InputView}(text_2.TextView),exports_8("InputView",InputView)}}}),System.register("tinyts/control/choice",["tinyts/control/input"],function(exports_9,context_9){"use strict";var input_1,ChoiceView;context_9&&context_9.id;return{setters:[function(input_1_1){input_1=input_1_1}],execute:function(){ChoiceView=function(_super){function ChoiceView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ChoiceView,_super),ChoiceView}(input_1.InputView),exports_9("ChoiceView",ChoiceView)}}}),System.register("tinyts/control/dialog",["tinyts/core/view"],function(exports_10,context_10){"use strict";function pauseEvent(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}var view_3,Dialog;context_10&&context_10.id;return{setters:[function(view_3_1){view_3=view_3_1}],execute:function(){Dialog=function(_super){function Dialog(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Dialog,_super),Dialog.prototype.LoadView=function(parent){var _this=this,succ=_super.prototype.LoadView.call(this,parent);if(succ){this.target.attr("data-draggable")&&this.initDraggable();var closeSelector=this.target.attr("data-close");closeSelector&&this.target.find(closeSelector).click(function(){_this.Hide()}),this.Hide()}return succ},Dialog.prototype.Hide=function(){this.display=this.target.css("display"),this.display&&"none"!=this.display||(this.display=""),this.target.css("display","none")},Dialog.prototype.Show=function(){this.target.css("display",this.display)},Dialog.prototype.initDraggable=function(){var me=this;this.target.mousedown(function(eventObject){eventObject.target instanceof HTMLInputElement||eventObject.target instanceof HTMLTextAreaElement||eventObject.target instanceof HTMLSelectElement||(pauseEvent(eventObject=eventObject||window.event),me.mouseX=eventObject.pageX-me.target.offset().left,me.mouseY=eventObject.pageY-me.target.offset().top,me.isMoving=!0)}),$(document).mousemove(function(eventObject){if(me.isMoving&&!(eventObject.target instanceof HTMLInputElement||eventObject.target instanceof HTMLTextAreaElement||eventObject.target instanceof HTMLSelectElement)&&(eventObject=eventObject||window.event,pauseEvent(eventObject),me.isMoving)){var scroll=$(window).scrollTop();me.target.css("top",eventObject.pageY-scroll-me.mouseY),me.target.css("left",eventObject.pageX-me.mouseX)}}),this.target.mouseup(function(){me.isMoving=!1})},Dialog}(view_3.View),exports_10("Dialog",Dialog)}}}),System.register("tinyts/control/table",["tinyts/control/list"],function(exports_11,context_11){"use strict";var list_1,Table;context_11&&context_11.id;return{setters:[function(list_1_1){list_1=list_1_1}],execute:function(){Table=function(_super){function Table(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Table,_super),Table.prototype.getTemplateString=function(target){return target.find("tbody").html()},Table.prototype.append=function(viewString,elemIndex){this.multipart?(null==elemIndex&&(elemIndex=0),this.target.eq(elemIndex).find("tbody").append(viewString)):this.target.find("tbody").append(viewString)},Table.prototype.ClearView=function(){this.target.find("tbody").html("")},Table}(list_1.ListView),exports_11("Table",Table)}}}),System.register("tinyts/model/injector",["tinyts/control/input","tinyts/control/choice","tinyts/control/text","tinyts/control/list","tinyts/core/view","class-validator"],function(exports_12,context_12){"use strict";function InjectWithoutValidate(TClass,context){var temp=new TClass;for(var property in context)if("context"!=property){var target=context[property];if(target instanceof view_4.View){if(target instanceof view_4.ViewG||target instanceof view_4.ViewV){var tt=InjectWithoutValidate(TClass,target);temp=$.extend({},temp,tt)}var propName=target.PropertyName();if(propName){var value;target instanceof input_2.InputView||target instanceof choice_1.ChoiceView?value=target.Value():list_2.ListView,TClass.prototype.hasOwnProperty(propName)?temp[propName]=value:null!=value&&(temp[propName]=value)}}}return temp}context_12&&context_12.id;exports_12("Resolve",function(context,model){if(null!=model)for(var prop in context){var target=context[prop];if(target instanceof view_4.View){var propName=target.PropertyName();if(propName){var value=model[propName];value?target instanceof text_3.TextView||target instanceof choice_1.ChoiceView?target.SetValue(value):target instanceof list_2.ListView&&$.isArray(value)?target.SetData(value):console.warn(propName+" resolve failed, control type is mismatching!"):console.warn(propName+" resolve failed, value invalid!")}}}else for(var prop in context)(target=context[prop])instanceof view_4.View&&(propName=target.PropertyName())&&(target instanceof text_3.TextView||target instanceof choice_1.ChoiceView?target.Clear():target instanceof list_2.ListView?target.SetData([]):console.warn(propName+" clear failed, missing clear method!"))}),exports_12("Inject",function(TClass,context){return new Promise(function(resolve,reject){var data=InjectWithoutValidate(TClass,context),temp=new TClass;for(var property in data)temp[property]=data[property];class_validator_1.validate(temp).then(function(errors){0==errors.length?resolve(temp):reject(errors)})})}),exports_12("ValidateData",function(TClass,data){return new Promise(function(resolve,reject){var temp=new TClass;for(var property in data)temp[property]=data[property];class_validator_1.validate(temp).then(function(errors){0==errors.length?resolve(temp):reject(errors)})})});var input_2,choice_1,text_3,list_2,view_4,class_validator_1;return{setters:[function(input_2_1){input_2=input_2_1},function(choice_1_1){choice_1=choice_1_1},function(text_3_1){text_3=text_3_1},function(list_2_1){list_2=list_2_1},function(view_4_1){view_4=view_4_1},function(class_validator_1_1){class_validator_1=class_validator_1_1}],execute:function(){}}}),System.register("tinyts/core/tinyts",["tinyts/core/view"],function(exports_13,context_13){"use strict";context_13&&context_13.id;exports_13("v",function(c,selector){return function(target,decoratedPropertyName){var targetType=target.constructor,name=target.constructor.toString().match(/^function\s*([^\s(]+)/)[1];targetType.hasOwnProperty("__inject__")||(targetType.__inject__={}),targetType.__inject__[name]||(targetType.__inject__[name]={constructor:target.constructor}),targetType.__inject__[name].views||(targetType.__inject__[name].views=[]);var temp=new view_5.injectModel;temp.creator=c,temp.propertyName=decoratedPropertyName,temp.selector=null==selector?"#"+decoratedPropertyName:selector,targetType.__inject__[name].views.push(temp)}}),exports_13("f",function(url){return function(constructor){constructor.__url__=url}}),exports_13("s",function(s){return function(target,decoratedPropertyName){var targetType=target.constructor,name=target.constructor.toString().match(/^function\s*([^\s(]+)/)[1];targetType.hasOwnProperty("__inject__")||(targetType.__inject__={}),targetType.__inject__[name]||(targetType.__inject__[name]={constructor:target.constructor}),targetType.__inject__[name].services||(targetType.__inject__[name].services=[]);var temp=new view_5.serviceInjectModel;temp.creator=s,temp.propertyName=decoratedPropertyName,targetType.__inject__[name].services.push(temp)}});var view_5,AncView;return{setters:[function(view_5_1){view_5=view_5_1}],execute:function(){AncView=function(_super){function AncView(selector){var _this=_super.call(this)||this,viewId=_this.constructor.toString().match(/^function\s*([^\s(]+)/)[1];return selector||(selector="#"+viewId),_this.SetSelector(selector),_this.SetName(viewId),_this.LoadView(),_this.Inject(),_this.Show(),_this}return __extends(AncView,_super),AncView.prototype.Show=function(){if(this.state==view_5.ViewState.LOADSUCC){var style=this.target.attr("style");if(!style)return;var aa=/display\s*:\s*none;?/;style=style.replace(aa,""),this.target.attr("style",style)}},AncView}(view_5.View),exports_13("AncView",AncView)}}}),System.register("tinyts/core/router",["tinyts/core/http"],function(exports_14,context_14){"use strict";var http_2,Router;context_14&&context_14.id;return{setters:[function(http_2_1){http_2=http_2_1}],execute:function(){Router=function(){function Router(){var me=this;this.routerMap={},window.onpopstate=function(event){var state=event.state;me.routerMap[state.url](state)}}return Router.prototype.GoBack=function(){window.history.back()},Router.prototype.GoForward=function(){window.history.forward()},Router.prototype.GoTo=function(url,data,param){if(!http_2.UrlParser.CompareUrls(window.location.href,url).Complete){var stateData={url:url,data:data,param:param};window.history.pushState&&window.history.pushState(stateData,"",url),this.routerMap[url]({url:url,data:data})}},Router.prototype.ReplaceCurrentState=function(url,data,param){var stateData={url:url,data:data,param:param};window.history.replaceState&&window.history.replaceState(stateData,"",url),this.routerMap[url]({url:url,data:data})},Router.prototype.ReplaceCurrentStateWithParam=function(url,data,changeRoute){var xx=new http_2.UrlParser;xx.Parse(url),xx.searchObject=$.extend(xx.searchObject,data);var url2=xx.Generate(),stateData={url:url,data:{}};window.history.replaceState&&window.history.replaceState(stateData,"",url2),changeRoute&&this.routerMap[url]({url:url2,data:stateData})},Router.prototype.AddRouter=function(url,func){this.routerMap[url]&&console.warn("router "+url+" already exist, overwrite it!"),this.routerMap[url]=func},Router}(),exports_14("Router",Router)}}}),System.register("tinyts/utils/cookie",[],function(exports_15,context_15){"use strict";var Cookie,CookieInstance;context_15&&context_15.id;return{setters:[],execute:function(){Cookie=function(){function Cookie(){}return Cookie.prototype.Get=function(key){var cookieValue=null;if(document.cookie&&""!=document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,key.length+1)==key+"="){cookieValue=decodeURIComponent(cookie.substring(key.length+1));break}}return cookieValue},Cookie.prototype.Remove=function(key){this.Set(key,null)},Cookie.prototype.Set=function(key,value,options){options=options||{},null===value&&(value="",(options=$.extend({},options)).expires=-1);var expires="";if(options.expires&&("number"==typeof options.expires||options.expires.toUTCString)){var date;"number"==typeof options.expires?(date=new Date).setTime(date.getTime()+24*options.expires*60*60*1e3):date=options.expires,expires="; expires="+date.toUTCString()}var path=options.path?"; path="+options.path:"",domain=options.domain?"; domain="+options.domain:"",secure=options.secure?"; secure":"";document.cookie=[key,"=",encodeURIComponent(value),expires,path,domain,secure].join("")},Cookie}(),exports_15("CookieInstance",CookieInstance=new Cookie)}}}),System.register("tinyts/utils/date",[],function(exports_16,context_16){"use strict";var TsDate;context_16&&context_16.id;return{setters:[],execute:function(){TsDate=function(){function TsDate(dateString){if(!dateString)return this.date=new Date,this;var D=new Date("2011-06-02T09:34:29+02:00");if(D&&1307000069e3==+D)this.date=new Date(dateString);else{var day,tz,p=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/.exec(dateString)||[];if(p[1]){for(var i=0,L=(day=p[1].split(/\D/)).length;i<L;i++)day[i]=parseInt(day[i],10)||0;day[1]-=1,(day=new Date(Date.UTC.apply(Date,day))).getDate()||(this.date=null),p[5]&&(tz=60*parseInt(p[5],10),p[6]&&(tz+=parseInt(p[6],10)),"+"==p[4]&&(tz*=-1),tz&&day.setUTCMinutes(day.getUTCMinutes()+tz)),this.date=day}this.date=null}}return TsDate.fromISO=function(s){var temp=new TsDate(s);return s?temp:null},TsDate.prototype.Format=function(fmt){var o={"M+":this.date.getMonth()+1,"d+":this.date.getDate(),"h+":this.date.getHours(),"m+":this.date.getMinutes(),"s+":this.date.getSeconds(),"q+":Math.floor((this.date.getMonth()+3)/3),S:this.date.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.date.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},TsDate}(),exports_16("TsDate",TsDate)}}}),System.register("tinyts/utils/time",[],function(exports_17,context_17){"use strict";var Time,CountDown;context_17&&context_17.id;return{setters:[],execute:function(){Time=function(){function Time(){}return Time.prototype.SetDay=function(d){return this._day=d,this},Time.prototype.SetHour=function(h){return this._hour=h,this},Time.prototype.SetMinute=function(m){return this._minute=m,this},Time.prototype.SetSecond=function(s){return this._second=s,this},Time.prototype.Reset=function(){this._day=this._hour=this._minute=this._second=0},Time.prototype.GetSeconds=function(){return this._second+60*this._minute+60*this._hour*60+24*this._day*60*60},Time.prototype.GetDateTime=function(){var ss=this.GetSeconds(),d=Math.floor(ss/86400);ss-=86400*d;var h=Math.floor(ss/3600);ss-=3600*h;var m=Math.floor(ss/60);return{s:ss-=60*m,m:m,h:h,d:d}},Time}(),exports_17("Time",Time),CountDown=function(){function CountDown(){}return CountDown.prototype.SetTime=function(s,m,h,d){var t=new Time;m||(m=0),h||(h=0),d||(d=0),this._seconds=t.SetDay(d).SetHour(h).SetMinute(m).SetSecond(s).GetSeconds()+1},CountDown.prototype.setInterval=function(){var me=this;this._running=!0,me.tick(),this._interval=setInterval(function(){me.tick()},1e3)},CountDown.prototype.clearInterval=function(){this._running=!1,this._interval&&(clearInterval(this._interval),this._interval=null)},CountDown.prototype.tick=function(){var me=this;if(me._running){if(me._cur--,0==me._cur)me.onFinished&&(me.onFinished(0),me.clearInterval());else if(me.onTick){var t=new Time;t.SetSecond(me._cur);var dd=t.GetDateTime();me.onTick(me._cur,dd)}}else me.clearInterval()},CountDown.prototype.Start=function(){if(!this._running){var me=this;me.onTick||me.onFinished?(this._cur=this._seconds,me.setInterval()):console.error("both onTick and onFinished undefined!")}},CountDown.prototype.Stop=function(){this._running&&(this.clearInterval(),this.onFinished&&this.onFinished(this._cur),this._cur=0)},CountDown.prototype.Pause=function(){this.clearInterval()},CountDown.prototype.Recover=function(){if(!this._running){this._running=!0,this.setInterval()}},CountDown.prototype.Reset=function(){this.clearInterval(),this._cur=0,this._seconds=0},CountDown}(),exports_17("CountDown",CountDown)}}});